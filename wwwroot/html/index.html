<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Yüz Kırpma & Özellik Seçimi - Modern Tasarım</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            color: #fff;
        }

        .container-wrapper {
            display: flex;
            gap: 48px;
            max-width: 1000px;
            width: 100%;
            justify-content: center;
            align-items: stretch;
            flex-wrap: wrap;
        }

        .card {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 16px 40px rgba(0,0,0,0.3);
            width: 480px;
            padding: 36px 40px 48px;
            color: #333;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 40px;
        }

            .card:hover {
                transform: translateY(-8px);
                box-shadow: 0 30px 60px rgba(0,0,0,0.45);
            }

        h2 {
            font-size: 34px;
            margin: 0 0 32px;
            font-weight: 700;
            background: linear-gradient(45deg, #f58529, #dd2a7b, #8134af, #515bd4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            user-select: none;
            text-align: center;
        }

        input[type="file"],
        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 14px 20px;
            font-size: 17px;
            border-radius: 16px;
            border: 1.8px solid #ddd;
            margin-bottom: 26px;
            transition: border-color 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

            input[type="file"]:hover, input[type="file"]:focus,
            input[type="number"]:hover, input[type="number"]:focus,
            input[type="text"]:hover, input[type="text"]:focus {
                border-color: #dd2a7b;
                outline: none;
                box-shadow: 0 4px 14px rgba(221,42,123,0.6);
            }

        .checkbox-group {
            margin-bottom: 32px;
        }

            .checkbox-group label {
                display: flex;
                align-items: center;
                font-weight: 600;
                color: #555;
                cursor: pointer;
                margin-bottom: 18px;
                user-select: none;
            }

            .checkbox-group input {
                margin-right: 14px;
                transform: scale(1.4);
                cursor: pointer;
            }

        button {
            background: linear-gradient(45deg, #f58529, #dd2a7b, #8134af, #515bd4);
            border: none;
            padding: 18px 0;
            border-radius: 20px;
            font-weight: 700;
            font-size: 22px;
            color: white;
            cursor: pointer;
            user-select: none;
            transition: background-position 0.6s ease, box-shadow 0.3s ease;
            background-size: 300% 300%;
            background-position: 0% 50%;
            box-shadow: 0 6px 15px rgba(221,42,123,0.6);
        }

            button:hover {
                background-position: 100% 50%;
                box-shadow: 0 10px 25px rgba(221,42,123,0.8);
            }

        #result1, #result2 {
            margin-top: 28px;
            font-weight: 700;
            font-size: 18px;
            min-height: 28px;
            text-align: center;
            user-select: none;
            color: #444;
            word-break: break-all;
        }

        .message-success {
            color: #27ae60;
        }

        .message-error {
            color: #e74c3c;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #dd2a7b;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            margin: 16px auto 0;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive alt alta geçiş */
        @media (max-width: 1020px) {
            body {
                padding: 24px 14px;
            }

            .container-wrapper {
                flex-direction: column;
                gap: 40px;
                max-width: 90vw;
                align-items: center;
            }

            .card {
                width: 100%;
                max-width: 480px;
            }
        }
    </style>
</head>
<body>

    <div class="container-wrapper">
        <!-- DetectFaceFeatures API card -->
        <div class="card" id="detectFaceFeaturesCard">
            <h2>DetectFaceFeatures</h2>
            <input type="file" id="photoInput1" accept="image/*" />
            <p id="selectedFileName1" style="text-align:center; color:#777; font-weight:600; margin:10px 0;"></p>
            <div class="checkbox-group">
                <label><input type="checkbox" id="iscropped" checked /> Kırpılmış hali için işaretle</label>
            </div>

            <label for="scaleFactor">Scale Factor (ör. 1.05):</label>
            <input type="number" id="scaleFactor" step="0.01" min="1" max="2" value="1.05" />

            <label for="minNeighbors">Min Neighbors (ör. 3):</label>
            <input type="number" id="minNeighbors" min="1" max="10" value="3" />

            <label for="minWidth">Min Face Width (px):</label>
            <input type="number" id="minWidth" min="1" max="500" value="30" />

            <label for="minHeight">Min Face Height (px):</label>
            <input type="number" id="minHeight" min="1" max="500" value="30" />

            <button onclick="uploadDetectFaceFeatures()">Gönder ve İndir</button>
            <div id="result1"></div>
        </div>

        <!-- SelectedFeatures API card -->
        <div class="card" id="selectedFeaturesCard">
            <h2>SelectedFeatures</h2>
            <input type="file" id="photoInput2" accept="image/*" />
            <p id="selectedFileName2" style="text-align:center; color:#777; font-weight:600; margin:10px 0;"></p>

            <div class="checkbox-group">
                <label><input type="checkbox" id="cropFace" checked /> Yüzü Kırp</label>
                <label><input type="checkbox" id="cropEyes" /> Gözleri Kırp</label>
                <label><input type="checkbox" id="cropNose" /> Burnu Kırp</label>
            </div>

            <label for="scaleFactor2">Scale Factor (ör. 1.05):</label>
            <input type="number" id="scaleFactor2" step="0.01" min="1" max="2" value="1.05" />

            <label for="minNeighbors2">Min Neighbors (ör. 3):</label>
            <input type="number" id="minNeighbors2" min="1" max="10" value="3" />

            <label for="minWidth2">Min Face Width (px):</label>
            <input type="number" id="minWidth2" min="1" max="500" value="30" />

            <label for="minHeight2">Min Face Height (px):</label>
            <input type="number" id="minHeight2" min="1" max="500" value="30" />

            <button onclick="uploadSelectedFeatures()">Gönder ve İndir</button>
            <div id="result2"></div>
        </div>
    </div>

    <script>
        // Dosya isimlerini gösterme
        document.getElementById('photoInput1').addEventListener('change', function () {
            const fileName = this.files.length ? this.files[0].name : '';
            document.getElementById('selectedFileName1').textContent = fileName;
        });
        document.getElementById('photoInput2').addEventListener('change', function () {
            const fileName = this.files.length ? this.files[0].name : '';
            document.getElementById('selectedFileName2').textContent = fileName;
        });

        async function uploadDetectFaceFeatures() {
            const input = document.getElementById('photoInput1');
            if (input.files.length === 0) {
                alert('Lütfen bir resim seçin.');
                return;
            }

            const formData = new FormData();
            formData.append('photo.File', input.files[0]);  // backend modelin FileUploadModel fotoğraf alanı

            // Query params
            const iscropped = document.getElementById('iscropped').checked;
            const scaleFactor = document.getElementById('scaleFactor').value;
            const minNeighbors = document.getElementById('minNeighbors').value;
            const minWidth = document.getElementById('minWidth').value;
            const minHeight = document.getElementById('minHeight').value;

            const url = `/api/DetectFaceFeatures/upload-and-process` +
                `?cropface=${iscropped}` +
                `&cropeyes=false` +  // DetectFaceFeatures'da sadece cropface kullanıyoruz burada
                `&cropnose=false` +
                `&scaleFactor=${scaleFactor}` +
                `&minNeighbors=${minNeighbors}` +
                `&minWidth=${minWidth}` +
                `&minHeight=${minHeight}`;

            setLoading('result1', true);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    setResult('result1', errorText, false);
                    setLoading('result1', false);
                    return;
                }

                const blob = await response.blob();

                if (blob.type === 'application/zip') {
                    downloadBlob(blob, 'cropped_faces.zip');
                    setResult('result1', 'Başarılı! Zip dosyası indirildi.', true);
                } else if (blob.type.startsWith('image/')) {
                    const url = URL.createObjectURL(blob);
                    setResult('result1', `<img src="${url}" style="max-width:100%; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.2)" />`, true);
                } else {
                    setResult('result1', 'Bilinmeyen dosya formatı alındı.', false);
                }
            } catch (err) {
                setResult('result1', 'İstek gönderilirken hata oluştu: ' + err.message, false);
            }

            setLoading('result1', false);
        }

        async function uploadSelectedFeatures() {
            const input = document.getElementById('photoInput2');
            if (input.files.length === 0) {
                alert('Lütfen bir resim seçin.');
                return;
            }

            const formData = new FormData();
            formData.append('photo.File', input.files[0]);

            // Query params
            const cropFace = document.getElementById('cropFace').checked;
            const cropEyes = document.getElementById('cropEyes').checked;
            const cropNose = document.getElementById('cropNose').checked;
            const scaleFactor = document.getElementById('scaleFactor2').value;
            const minNeighbors = document.getElementById('minNeighbors2').value;
            const minWidth = document.getElementById('minWidth2').value;
            const minHeight = document.getElementById('minHeight2').value;

            const url = `/api/DetectFaceFeatures/upload-and-process` +
                `?cropface=${cropFace}` +
                `&cropeyes=${cropEyes}` +
                `&cropnose=${cropNose}` +
                `&scaleFactor=${scaleFactor}` +
                `&minNeighbors=${minNeighbors}` +
                `&minWidth=${minWidth}` +
                `&minHeight=${minHeight}`;

            setLoading('result2', true);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    setResult('result2', errorText, false);
                    setLoading('result2', false);
                    return;
                }

                const blob = await response.blob();

                if (blob.type === 'application/zip') {
                    downloadBlob(blob, 'cropped_features.zip');
                    setResult('result2', 'Başarılı! Zip dosyası indirildi.', true);
                } else if (blob.type.startsWith('image/')) {
                    const url = URL.createObjectURL(blob);
                    setResult('result2', `<img src="${url}" style="max-width:100%; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.2)" />`, true);
                } else {
                    setResult('result2', 'Bilinmeyen dosya formatı alındı.', false);
                }
            } catch (err) {
                setResult('result2', 'İstek gönderilirken hata oluştu: ' + err.message, false);
            }

            setLoading('result2', false);
        }

        function setLoading(resultId, isLoading) {
            const container = document.getElementById(resultId);
            if (isLoading) {
                container.innerHTML = '<div class="loading-spinner"></div>';
            } else {
                // loading bitti, içerik kalacak
            }
        }

        function setResult(resultId, messageOrHtml, success) {
            const container = document.getElementById(resultId);
            container.innerHTML = messageOrHtml;
            container.className = success ? 'message-success' : 'message-error';
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }
    </script>

</body>
</html>
